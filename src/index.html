<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>AngularFormWithStepsV4</title>
		<meta http-equiv="Permissions-Policy" content="interest-cohort=()" />
		<base href="/youtube-mp3-downloader/" />
		<!-- before deploying dont forget to change href  back, and while debugging set to "/" -->
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/x-icon" href="favicon.ico" />
		<link
			href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap"
			rel="stylesheet"
		/>
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
	</head>
	<body class="mat-typography" style="background-color: #fbf2eb">
		<script src="https://apis.google.com/js/api.js"></script>
		<div style="display: flex; justify-content: space-between">
			<!-- <button style="height: 50px; width: 120px" onclick="triggerDownloadAll()">
				TRIGGER ALL DOWNLOAD
			</button> -->
			<select
				style="height: 1px; width: 1px; display: hidden"
				name="project"
				id="project"
				onChange="handleProjectChange()"
			>
				<option value="youtube-mp3-downloader-392415" id="youtube-mp3-downloader-392415">
					youtube-mp3-downloader-392415
				</option>
				<option value="youtube-downloader-310313" id="youtube-downloader-310313">
					youtube-downloader-310313
				</option>
				<option value="youtube-mp3-downloader-3" id="youtube-mp3-downloader-3">
					youtube-mp3-downloader-3
				</option>
			</select>
			<select
				style="height: 1px; width: 1px; display: hidden"
				name="env"
				id="env"
				onChange="handleEnv()"
			>
				<option value="local" id="local">local</option>
				<option value="github" id="github">github</option>
			</select>
		</div>

		<app-root></app-root>

		<script>
			function handleProjectChange(passedValue) {
				var value = document.getElementById("project").value;
				localStorage.setItem("project", passedValue || value);
				if (passedValue) {
					document.getElementById(passedValue).setAttribute("selected", true);
				}
			}

			function handleProjectsChange(passedValue) {
				localStorage.setItem("projects", passedValue);
			}

			function handleEnv(passedValue) {
				var value = document.getElementById("env").value;
				localStorage.setItem("env", passedValue || value);
				if (passedValue) {
					document.getElementById(passedValue).setAttribute("selected", true);
				}
			}
			handleEnv(localStorage.getItem("env"));

			//IMPORTANT:projects can be passed via URL before stringifying the array of them [{name, apiKey}]
			const projects = new URL(window.location.href).searchParams.get("projects");
			if (projects) {
				handleProjectsChange(projects);
				const parsedProjects = JSON.parse(projects);
				let arrOptions = [];
				parsedProjects.forEach((p) =>
					arrOptions.push(
						"<option value='" + p.name + "' id='" + p.name + "'>" + p.name + "</option>"
					)
				);
				document.getElementById("project").innerHTML = arrOptions.join();
			}
			const projectNameFromUrl = new URL(window.location.href).searchParams.get("projectName");
			// use apikey if needed
			const projectApiKeyFromUrl = new URL(window.location.href).searchParams.get("projectName");
			const project = localStorage.getItem("project");
			gapi.load("client:auth2", function () {
				if (projectNameFromUrl || project) {
					handleProjectChange(projectNameFromUrl || project);
					gapi.auth2.init({
						client_id: projectNameFromUrl || project
					});
				}
			});
		</script>
	</body>
</html>
